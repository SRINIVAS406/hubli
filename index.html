<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Dharwad Constituency</title>
</head>

<body>

    <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">BJP</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/">Home</a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>


    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <div class="mt-5">
        <hr>
    </div>
    <div class="container mt-5">
        <div id="chart_div"></div>
    </div>

    <!-- cardblock -->
    <!-- <div style="display:none;" id="cardblock">
        <div id="tnode" class="tnode" style="width:auto;">
            <div id="cardid">DPS1</div>
            <div class="card_body">
                <img src="male.png" alt="Avatar" id="cardimg" style="width:50px;height:50px;">
                <div class="">
                    <p><b id="cardname">Ram</b></p>
                    <p id="cardtitle">Javascript</p>
                    <input type="button" class="form-control btn-secondary btn-sm" id="showdetail"
                        value="ShowMore"></button>
                </div>
                <div class="showhidechildren"><button type="button" id="showchild" class="btn btn-default">
                        <i class="fa fa-angle-double-down"></i>
                    </button>
                    <button type="button" id="hidechild" class="btn btn-default">
                        <i class="fa fa-angle-double-down"></i>
                    </button>
                </div>

            </div>

        </div>
    </div> -->

    <!-- Form Model -->
    <!-- Button trigger modal -->
    <button style="display:none;" type="button" id="openblockdetail" class="btn btn-primary" data-bs-toggle="modal"
        data-bs-target="#blockdetail">
    </button>

    <!-- Modal -->
    <div style="display:none;" class="modal fade" id="blockdetail" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="blockdetailLabel">Block title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><a
                            href="#chart_div"></a></button>
                </div>
                <div class="modal-body">
                    <!-- ***************************Form Data***************************** -->
                    <div class="container">
                        <div class="center"><img src="male.png" alt="Avatar" id="cardimg" style="display: block;
                            margin-left: auto;
                            margin-right: auto;
                            width: 50%;"></div>
                        <form>
                            <div class="mb-3">
                                <label for="name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="name" aria-describedby="emailHelp"
                                    name="name">

                            </div>
                            <div class="mb-3">
                                <label for="age" class="form-label">Age</label>
                                <input type="number" class="form-control" id="age" name="age">
                            </div>
                            <div class="mb-3">
                                <label for="gender" class="form-label">Gender</label>
                                <input type="text" class="form-control" id="gender" name="gender">
                            </div>
                            <div class="mb-3">
                                <label for="ward_no" class="form-label">Ward Number</label>
                                <input type="text" class="form-control" id="ward_no" name="ward_no">
                            </div>
                            <div class="mb-3">
                                <label for="poll_no" class="form-label">Polling Station Number</label>
                                <input type="text" class="form-control" id="poll_no" name="poll_no">
                            </div>
                            <div class="mb-3">
                                <label for="booth_no" class="form-label">Booth Number</label>
                                <input type="text" class="form-control" id="booth_no" name="booth_no">
                            </div>
                            <div class="mb-3">
                                <label for="caste" class="form-label">Caste</label>
                                <input type="text" class="form-control" id="caste" name="caste">
                            </div>
                            <div class="mb-3">
                                <label for="sub_caste" class="form-label">Sub-Caste</label>
                                <input type="text" class="form-control" id="sub_caste" name="sub_caste">
                            </div>
                            <div class="mb-3">
                                <label for="address" class="form-label">House Address</label>
                                <textarea class="form-control" id="address" name="address" rows="5">
                                </textarea>
                            </div>
                            <div class="mb-3">
                                <label for="id_proof" class="form-label">ID Proof</label>
                                <input type="text" class="form-control" id="id_proof" name="id_proof">
                                <div id="emailHelp" class="form-text">Please provide authentic proof.</div>
                            </div>

                            <!-- <button type="submit" class="btn btn-primary">Submit</button> -->
                        </form>
                    </div>
                    <!-- ***************************************************************** -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        var allData = [];
        var treeData = [];
        fetch('data1.json').then((response) => response.json()).then((json) => {
            //console.log(json);
            if (json) {
                treeData = json;
                for (let i in json) {
                    
                    let nodeobj = {};
                    nodeobj.v = i;
                    nodeobj.f = getTreeNode(i, json[i].name, json[i].title);
                    if (json[i].parent == 'DPS1' || json[i].parent == '' )
                    allData.push([nodeobj, json[i].parent, treeData[i].name])
                }
                console.log(allData);
            }
            //allData = ; 
        });

        google.charts.load('current', { packages: ["orgchart"] });
        google.charts.setOnLoadCallback(drawChart);
        function getid(id) {
            return document.getElementById(id);
        }
        function drawChart() {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Name');
            data.addColumn('string', 'Manager');
            data.addColumn('string', 'ToolTip');


            // For each orgchart box, provide the name, manager, and tooltip to show.
            data.addRows(allData);

            // Create the chart.
            var chart = new google.visualization.OrgChart(document.getElementById('chart_div'));
            // Draw the chart, setting the allowHtml option to true for the tooltips.
            //addintion options
            chart.draw(data, { 'allowHtml': true }); //"nodeClass":"card"}
            

            //calling methods
            //console.log(chart.getChildrenIndexes('12'));
            //chart.collapse('3', true);
            console.log(chart.getChildrenIndexes(3+''));

            //calling event
            //google.visualization.events.addListener(chart, 'select', selectHandler);

        }

        function selectHandler1(key) {
            var message = '';
            message = treeData[key];
            getid('blockdetailLabel').innerHTML = message.name;
            getid('name').value = message.name;
            getid('age').value = message.age;
            getid('gender').value = message.gender;
            getid('ward_no').value = message.ward_no;
            getid('poll_no').value = message.poll_no;
            getid('booth_no').value = message.booth_no;
            getid('caste').value = message.caste;
            getid('sub_caste').value = message.sub_caste;
            getid('address').value = message.address;
            getid('id_proof').value = message.id_proof;

            getid('openblockdetail').click();
            if (message == '') {
                message = 'nothing';
            }
            //alert('You selected ' + message);
        }


        //show children onclick of node
        function showChildNodes(key) {
            for (let i in treeData) {
                if (treeData[i].parent == key) {
                    
                    let nodeobj1 = {};
                    nodeobj1.v = i;
                    nodeobj1.f = getTreeNode(i, treeData[i].name, treeData[i].title);
                    allData.push([nodeobj1, treeData[i].parent, treeData[i].name])
                    //alert(treeData[i].name);
                }

            }
            drawChart();
            //console.log(allData);

        }

        //show children onclick of node
        function hideChildNodes(key) {
            for (i in allData) {
                if (allData[i][1] == key) {
                    //allData.splice(i, 1);
                }
            }
            drawChart();
        }

        function getTreeNode(i,name,title){
            var treecard = `<div id="cardblock">
        <div id="tnode" class="tnode" style="width:auto;">
            <div id="cardid">${i}</div>
            <div class="card_body">
                <img src="male.png" alt="Avatar" id="cardimg" style="width:50px;height:50px;">
                <div class="">
                    <p><b id="cardname">${treeData[i].name}</b></p>
                    <p id="cardtitle">${treeData[i].title}</p>
                    <input type="button" class="form-control btn-secondary btn-sm" id="showdetail" onclick="selectHandler1('${i}')"
                        value="ShowMore"></button>
                </div>
                <div class="showhidechildren"><button type="button" id="showchild" class="btn btn-default" onclick="showChildNodes('${i}')">
                        <i class="fa fa-angle-double-down"></i>
                    </button>
                  <!--  <button type="button" id="hidechild" class="btn btn-default" onclick="hideChildNodes('${i}')">
                        <i class="fa fa-angle-double-up"></i>
                    </button> -->
                </div>

            </div>

        </div>
    </div>`;

    return treecard;
        }
    </script>

    <style>
        .card {
            box-shadow: rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px;
            border-radius: 5px;
        }

        .card:hover {
            box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>

</html>